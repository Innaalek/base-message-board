<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Base Message Board</title>
<script src="https://cdn.ethers.io/lib/ethers-6.7.0.umd.min.js"></script>
</head>
<body style="background:#0a0a0f;color:white;font-family:Arial;padding:20px">

<button id="connectBtn" style="width:100%;padding:12px;font-size:18px;border-radius:6px;cursor:pointer">
Connect MetaMask
</button>

<textarea id="msg" placeholder="Write a message to publish on Base..." 
style="width:100%;margin-top:12px;padding:10px;border-radius:6px;font-size:16px"></textarea>

<button id="publishBtn" style="width:100%;margin-top:10px;padding:12px;font-size:18px;border-radius:6px;cursor:pointer">
Publish
</button>

<script>
const contractAddress = "0x2E1476Ba7D284e931389710904569FFdd1eC10F1";
const abi = ["function postMessage(string _text) external"];

let userAddress = null;

if (!window.ethereum) {
  alert("MetaMask not found. Please install it.");
}

document.getElementById("connectBtn").addEventListener("click", async () => {
  try {
    const accounts = await ethereum.request({ method: "eth_requestAccounts" });
    userAddress = accounts[0];
    alert("Wallet connected: " + userAddress);
  } catch (err) {
    alert("Connection failed");
  }
});

document.getElementById("publishBtn").addEventListener("click", async () => {
  try {
    if (!userAddress) {
      return alert("Connect wallet first");
    }

    const provider = new ethers.BrowserProvider(window.ethereum);
    const signer = await provider.getSigner();
    const contract = new ethers.Contract(contractAddress, abi, signer);

    const message = document.getElementById("msg").value.trim();
    if (!message) {
      return alert("Message cannot be empty");
    }

    const tx = await contract.postMessage(message);
    await tx.wait();

    alert("Message successfully published on-chain!");
  } catch (err) {
    alert("Publish failed. See console for details.");
    console.error(err);
  }
});
</script>

</body>
</html>
